[
  {
    "id": "deps-003",
    "severity": "critical",
    "category": "deps",
    "file": "pyproject.toml",
    "line": null,
    "issue": "python-jose 3.3.0 has CVE-2024-33663 (algorithm confusion: RS256 tokens validated with HS256 using public key as HMAC secret) and CVE-2024-33664 (incorrect RSA key validation allowing forged tokens). Library is effectively abandoned — last release 2022-06, no security patches planned. JWT auth is a critical attack surface.",
    "task": "Migrate from python-jose to authlib or joserfc. Both are actively maintained, CVE-free, and support the same JWT/JWK standards. Update all usages in app/services/auth_dependencies.py and related JWT creation/validation code.",
    "auto_fixable": false,
    "effort": "medium",
    "package": "python-jose",
    "current_version": "3.3.0",
    "latest_version": "abandoned — replace with authlib>=1.3",
    "cves": ["CVE-2024-33663", "CVE-2024-33664"]
  },
  {
    "id": "deps-004",
    "severity": "high",
    "category": "deps",
    "file": "pyproject.toml",
    "line": null,
    "issue": "passlib 1.7.4 is effectively abandoned (last release November 2020, maintainer unresponsive). The bcrypt extra is broken with bcrypt>=4.0.0 due to API changes in the underlying bcrypt library (return type changed). pip list shows bcrypt 3.2.0 on system vs 5.0.0 latest — the Poetry venv may resolve a version that breaks passlib silently at runtime.",
    "task": "Replace passlib[bcrypt] with direct bcrypt>=4.0.0 usage or switch to argon2-cffi for password hashing. Update all app/services/ password hashing and verification calls. If migrating to direct bcrypt, ensure hash format compatibility with existing stored hashes.",
    "auto_fixable": false,
    "effort": "medium",
    "package": "passlib",
    "current_version": "1.7.4",
    "latest_version": "1.7.4 (abandoned)"
  },
  {
    "id": "deps-005",
    "severity": "medium",
    "category": "deps",
    "file": "pyproject.toml",
    "line": null,
    "issue": "opentelemetry-instrumentation-fastapi, opentelemetry-instrumentation-sqlalchemy, and opentelemetry-instrumentation-celery are all pinned to 0.60b1 (beta). While an upgrade from 0.47b0, beta packages in production carry risk of unresolved bugs and breaking API changes. opentelemetry-api/sdk is pinned to 1.39.1 — verify this beta instrumentation is compatible with the stable SDK version.",
    "task": "Check if stable 0.6x releases exist for all three instrumentation packages and upgrade. Pin all opentelemetry packages to a consistent stable release. If 0.60b1 is the only available version, document the constraint.",
    "auto_fixable": false,
    "effort": "small",
    "package": "opentelemetry-instrumentation-fastapi",
    "current_version": "0.60b1",
    "latest_version": "0.60b1 (beta — check for stable)"
  },
  {
    "id": "deps-006",
    "severity": "medium",
    "category": "deps",
    "file": "pyproject.toml",
    "line": null,
    "issue": "weasyprint 61.2 is significantly outdated (latest 65.x). WeasyPrint is used for PDF generation; older versions have had SSRF vulnerabilities when rendering user-supplied HTML with external @import or <img src> references, and CSS injection issues. Given existing SSRF findings in this codebase, this is elevated risk.",
    "task": "Upgrade weasyprint from 61.2 to >=65.0. After upgrading, audit all call sites to ensure user-supplied HTML is sanitised before passing to weasyprint or that URL loading is restricted via base_url parameter.",
    "auto_fixable": true,
    "effort": "small",
    "package": "weasyprint",
    "current_version": "61.2",
    "latest_version": "65.x"
  },
  {
    "id": "deps-008",
    "severity": "medium",
    "category": "deps",
    "file": "pyproject.toml",
    "line": null,
    "issue": "pydantic is pinned to exactly 2.7.4, but pydantic_core 2.41.5 is installed (visible in pip --outdated). pydantic_core 2.41.x corresponds to pydantic ~2.11.x — suggesting the lock file has been updated beyond the pyproject.toml constraint. This version mismatch between pyproject.toml and poetry.lock creates reproducibility risk. pydantic 2.11.x includes validator edge-case security fixes and Rust-core memory safety improvements.",
    "task": "Align pyproject.toml to reflect the actually installed version: update pydantic constraint to >=2.11.0. Run `poetry update pydantic pydantic-core` and commit the updated lock. Also upgrade pydantic_core from 2.41.5 to 2.42.0.",
    "auto_fixable": true,
    "effort": "trivial",
    "package": "pydantic",
    "current_version": "2.7.4 (pyproject.toml) / ~2.11.x (lock)",
    "latest_version": "2.11.x"
  },
  {
    "id": "deps-009",
    "severity": "low",
    "category": "deps",
    "file": "pyproject.toml",
    "line": null,
    "issue": "httpx 0.27.0 is one minor version behind latest (0.28.x). The 0.28.x release includes HTTP/2 improvements, SSRF mitigations for certain redirect scenarios, and timeout handling fixes. Given the SSRF findings elsewhere in this codebase, staying current on the HTTP client is advisable.",
    "task": "Upgrade httpx from 0.27.0 to >=0.28.0 in pyproject.toml.",
    "auto_fixable": true,
    "effort": "trivial",
    "package": "httpx",
    "current_version": "0.27.0",
    "latest_version": "0.28.x"
  },
  {
    "id": "deps-010",
    "severity": "low",
    "category": "deps",
    "file": "pyproject.toml",
    "line": null,
    "issue": "celery 5.4.0 is behind latest 5.5.x. Recent releases include task revocation security fixes, broker connection hardening, and important bug fixes for Redis result backends used in this project.",
    "task": "Upgrade celery from 5.4.0 to >=5.5.0 in pyproject.toml. Verify Celery worker startup and beat scheduler behaviour post-upgrade.",
    "auto_fixable": true,
    "effort": "trivial",
    "package": "celery",
    "current_version": "5.4.0",
    "latest_version": "5.5.x"
  },
  {
    "id": "deps-011",
    "severity": "low",
    "category": "deps",
    "file": "pyproject.toml",
    "line": null,
    "issue": "redis 5.0.4 is behind latest 5.2.x. Redis-py 5.1/5.2 includes connection pool improvements, TLS certificate validation fixes, and RESP3 protocol stability enhancements.",
    "task": "Upgrade redis from 5.0.4 to >=5.2.0 in pyproject.toml.",
    "auto_fixable": true,
    "effort": "trivial",
    "package": "redis",
    "current_version": "5.0.4",
    "latest_version": "5.2.x"
  },
  {
    "id": "deps-012",
    "severity": "low",
    "category": "deps",
    "file": "pyproject.toml",
    "line": null,
    "issue": "sqlalchemy 2.0.31 is behind latest 2.0.40+. Patch releases include ORM edge-case fixes, connection pool correctness improvements, and type stub updates relevant to the mypy setup.",
    "task": "Upgrade sqlalchemy from 2.0.31 to >=2.0.40 in pyproject.toml.",
    "auto_fixable": true,
    "effort": "trivial",
    "package": "sqlalchemy",
    "current_version": "2.0.31",
    "latest_version": "2.0.40+"
  },
  {
    "id": "deps-013",
    "severity": "low",
    "category": "deps",
    "file": "pyproject.toml",
    "line": null,
    "issue": "alembic 1.13.2 is behind latest 1.14.x. Minor release includes migration environment fixes and improved autogenerate accuracy for PostGIS/GeoAlchemy2 column types.",
    "task": "Upgrade alembic from 1.13.2 to >=1.14.0 in pyproject.toml.",
    "auto_fixable": true,
    "effort": "trivial",
    "package": "alembic",
    "current_version": "1.13.2",
    "latest_version": "1.14.x"
  },
  {
    "id": "deps-014",
    "severity": "low",
    "category": "deps",
    "file": "pyproject.toml",
    "line": null,
    "issue": "shapely 2.0.4 is behind latest 2.1.x. The 2.1 release includes geometry precision improvements and GEOS library updates relevant to geospatial subscriber/coverage queries.",
    "task": "Upgrade shapely from 2.0.4 to >=2.1.0 in pyproject.toml. Verify GeoAlchemy2 0.14.7 compatibility (it supports Shapely 2.1).",
    "auto_fixable": true,
    "effort": "trivial",
    "package": "shapely",
    "current_version": "2.0.4",
    "latest_version": "2.1.x"
  },
  {
    "id": "deps-015",
    "severity": "low",
    "category": "deps",
    "file": "pyproject.toml",
    "line": null,
    "issue": "System-level urllib3 1.26.5 is present alongside the project virtualenv. urllib3 1.26.x has CVE-2023-43804 (header injection) and CVE-2023-45803 (chunked transfer encoding bypass). If any code path uses the system Python or if pip installs dependencies outside the venv, this is exploitable.",
    "task": "Verify `pip show urllib3` inside the activated Poetry virtualenv returns >=2.0. If not, add urllib3>=2.0 as an explicit dependency. Ensure deployment scripts activate the venv before running any Python.",
    "auto_fixable": false,
    "effort": "small",
    "package": "urllib3",
    "current_version": "1.26.5 (system)",
    "latest_version": "2.6.3",
    "cves": ["CVE-2023-43804", "CVE-2023-45803"]
  }
]
