{% extends "layouts/customer.html" %}

{% block title %}Service Details - Customer Portal{% endblock %}

{% block content %}
{% set status_value = subscription.status.value if subscription.status and subscription.status.value is defined else subscription.status %}
<div class="space-y-6">
    <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
        <div>
            <nav class="flex items-center gap-2 text-sm text-stone-500 dark:text-stone-400 mb-2">
                <a href="/portal/services" class="hover:text-[var(--color-brand-600)]">Services</a>
                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
                <span class="text-stone-900 dark:text-white">Service Details</span>
            </nav>
            <div class="flex flex-wrap items-center gap-3">
                <h1 class="text-2xl font-display font-bold text-stone-900 dark:text-white">
                    {{ current_offer.name if current_offer else (subscription.offer.name if subscription.offer else 'Service') }}
                </h1>
                <span class="inline-flex items-center gap-1.5 rounded-lg px-3 py-1.5 text-xs font-semibold
                    {% if status_value == 'active' %}bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400
                    {% elif status_value == 'suspended' %}bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400
                    {% else %}bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400{% endif %}">
                    {% if status_value == 'active' %}
                    <span class="relative flex h-2 w-2">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
                    </span>
                    {% endif %}
                    {{ status_value | default('Active') | capitalize }}
                </span>
            </div>
            <p class="mt-1 text-sm text-stone-500 dark:text-stone-400">
                {{ subscription.offer_version.name if subscription.offer_version else 'Plan details and management' }}
            </p>
        </div>
        <div class="flex flex-wrap items-center gap-3">
            <a href="/portal/services/{{ subscription.id }}/change" class="inline-flex items-center gap-2 rounded-xl bg-[var(--color-brand-600)] px-5 py-2.5 text-sm font-semibold text-white shadow-lg shadow-[var(--color-brand-600)]/20 transition-all hover:bg-[var(--color-brand-700)]">
                Change Plan
            </a>
            <a href="/portal/change-requests" class="inline-flex items-center gap-2 rounded-xl border-2 border-stone-200 bg-white px-5 py-2.5 text-sm font-semibold text-stone-700 shadow-sm transition-all hover:border-stone-300 hover:shadow-md dark:border-stone-700 dark:bg-stone-800 dark:text-stone-300 dark:hover:border-stone-600">
                View Requests
            </a>
        </div>
    </div>

    <div class="grid gap-4 md:grid-cols-2 xl:grid-cols-4">
        <div class="rounded-2xl border border-stone-200 bg-white p-5 shadow-sm dark:border-stone-700 dark:bg-stone-800">
            <p class="text-xs font-semibold uppercase tracking-wide text-stone-500 dark:text-stone-400">Speed</p>
            <p class="mt-2 text-xl font-semibold text-stone-900 dark:text-white">{{ subscription.speed | default('—') }}</p>
        </div>
        <div class="rounded-2xl border border-stone-200 bg-white p-5 shadow-sm dark:border-stone-700 dark:bg-stone-800">
            <p class="text-xs font-semibold uppercase tracking-wide text-stone-500 dark:text-stone-400">Next Bill</p>
            <p class="mt-2 text-xl font-semibold text-stone-900 dark:text-white">
                {{ next_billing_date.strftime('%b %d, %Y') if next_billing_date else 'N/A' }}
            </p>
        </div>
        <div class="rounded-2xl border border-stone-200 bg-white p-5 shadow-sm dark:border-stone-700 dark:bg-stone-800">
            <p class="text-xs font-semibold uppercase tracking-wide text-stone-500 dark:text-stone-400">Started</p>
            <p class="mt-2 text-xl font-semibold text-stone-900 dark:text-white">
                {{ subscription.start_at.strftime('%b %d, %Y') if subscription.start_at else (subscription.created_at.strftime('%b %d, %Y') if subscription.created_at else '—') }}
            </p>
        </div>
        <div class="rounded-2xl border border-stone-200 bg-white p-5 shadow-sm dark:border-stone-700 dark:bg-stone-800">
            <p class="text-xs font-semibold uppercase tracking-wide text-stone-500 dark:text-stone-400">Subscription</p>
            <p class="mt-2 text-sm font-semibold text-stone-900 dark:text-white break-all">#{{ subscription.id }}</p>
        </div>
    </div>

    <div class="grid gap-6 lg:grid-cols-2">
        <div class="rounded-2xl border border-stone-200 bg-white p-6 shadow-sm dark:border-stone-700 dark:bg-stone-800">
            <h2 class="text-lg font-display font-semibold text-stone-900 dark:text-white">Plan Summary</h2>
            <p class="mt-2 text-sm text-stone-500 dark:text-stone-400">
                {{ current_offer.description if current_offer and current_offer.description else 'Review your current plan and pricing.' }}
            </p>
            {% if current_offer %}
            <div class="mt-4 flex items-baseline justify-between rounded-xl bg-stone-50 px-4 py-3 dark:bg-stone-700/40">
                <div>
                    <p class="text-sm font-medium text-stone-600 dark:text-stone-300">Current plan</p>
                    <p class="text-base font-semibold text-stone-900 dark:text-white">{{ current_offer.name }}</p>
                </div>
                <p class="text-lg font-semibold text-[var(--color-brand-600)] dark:text-[var(--color-brand-400)]">
                    {{ current_offer.currency or 'NGN' }} {{ '{:,.2f}'.format(current_offer.price or 0) }}
                    <span class="text-sm font-normal text-stone-500 dark:text-stone-400">/month</span>
                </p>
            </div>
            {% endif %}
            <div class="mt-5 flex flex-wrap items-center gap-3">
                <a href="/portal/services/{{ subscription.id }}/change" class="inline-flex items-center gap-2 rounded-lg bg-[var(--color-brand-600)] px-4 py-2 text-sm font-semibold text-white hover:bg-[var(--color-brand-700)]">
                    Change plan
                </a>
                <a href="/portal/change-requests" class="inline-flex items-center gap-2 rounded-lg border border-stone-200 bg-white px-4 py-2 text-sm font-semibold text-stone-700 hover:border-stone-300 dark:border-stone-700 dark:bg-stone-800 dark:text-stone-300">
                    View change requests
                </a>
            </div>
        </div>

        <div class="rounded-2xl border border-stone-200 bg-white p-6 shadow-sm dark:border-stone-700 dark:bg-stone-800">
            <h2 class="text-lg font-display font-semibold text-stone-900 dark:text-white">Need help?</h2>
            <p class="mt-2 text-sm text-stone-500 dark:text-stone-400">
                Billing questions or service issues can be resolved quickly through the portal.
            </p>
            <div class="mt-5 grid gap-3">
                <a href="/portal/billing" class="inline-flex items-center justify-between rounded-xl border border-stone-200 px-4 py-3 text-sm font-semibold text-stone-700 transition hover:border-stone-300 hover:bg-stone-50 dark:border-stone-700 dark:text-stone-300 dark:hover:bg-stone-700/50">
                    View billing
                    <svg class="h-4 w-4 text-stone-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                </a>
                <a href="/portal/support/new" class="inline-flex items-center justify-between rounded-xl border border-stone-200 px-4 py-3 text-sm font-semibold text-stone-700 transition hover:border-stone-300 hover:bg-stone-50 dark:border-stone-700 dark:text-stone-300 dark:hover:bg-stone-700/50">
                    Report an issue
                    <svg class="h-4 w-4 text-stone-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
