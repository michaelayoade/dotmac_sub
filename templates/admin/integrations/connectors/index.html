{% extends "layouts/admin.html" %}
{% from "components/ui/macros.html" import ambient_background, page_header, stats_card, card, data_table, table_head, table_row, row_actions, row_action, status_badge, empty_state, action_button, icon_plus, icon_view, animation_styles %}

{% block title %}Connectors - Integrations{% endblock %}

{% block content %}
{{ ambient_background("indigo", "violet") }}

<div class="relative space-y-6">
    {# Page Header #}
    {% call page_header(
        title="Connectors",
        subtitle="Reusable connection configurations for external systems",
        icon='<svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z"/></svg>',
        color="indigo",
        color2="violet"
    ) %}
        {{ action_button("WhatsApp Config", "/admin/integrations/whatsapp/config", "", "secondary", "emerald", "teal") }}
        {{ action_button("Add Connector", "/admin/integrations/connectors/new", icon_plus(), "primary", "indigo", "violet") }}
    {% endcall %}

    {# KPI Cards #}
    <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-4 animate-fade-in-up" style="animation-delay: 50ms;">
        {{ stats_card("Total", stats.total, icon='<svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z"/></svg>', color="slate", color2="gray") }}
        {{ stats_card("Active", stats.active, icon='<svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>', color="emerald", color2="teal") }}
        {{ stats_card("HTTP / Webhook", (stats.by_type.http or 0) + (stats.by_type.webhook or 0), icon='<svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/></svg>', color="blue", color2="indigo") }}
        {{ stats_card("Stripe / Twilio", (stats.by_type.stripe or 0) + (stats.by_type.twilio or 0), icon='<svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/></svg>', color="violet", color2="purple") }}
    </div>

    {# Connectors Table #}
    <div class="animate-fade-in-up" style="animation-delay: 100ms;">
    {% call card("Connectors", color="indigo") %}
        {% if connectors %}
        {% call data_table() %}
            {{ table_head(["Connector", "Type", "Auth", "Base URL", "Status", ""]) }}
            <tbody class="divide-y divide-slate-200 bg-white dark:divide-slate-700 dark:bg-slate-800">
                {% for connector in connectors %}
                {% set type_val = connector.connector_type.value if connector.connector_type else 'custom' %}
                {% set auth_val = connector.auth_type.value if connector.auth_type else 'none' %}
                {% call table_row(connector.id) %}
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center gap-3">
                            <div class="flex h-10 w-10 items-center justify-center rounded-lg bg-indigo-100 dark:bg-indigo-900/30">
                                <svg class="h-5 w-5 text-indigo-600 dark:text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z"/></svg>
                            </div>
                            <div>
                                <a href="/admin/integrations/connectors/{{ connector.id }}" class="text-sm font-medium text-indigo-600 hover:text-indigo-700 dark:text-indigo-400">{{ connector.name }}</a>
                                {% if connector.notes %}
                                <p class="text-xs text-slate-500 dark:text-slate-400 truncate max-w-xs">{{ connector.notes }}</p>
                                {% endif %}
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        {% set type_colors = {'webhook': 'info', 'http': 'info', 'smtp': 'warning', 'stripe': 'active', 'twilio': 'active', 'custom': 'neutral'} %}
                        {{ status_badge(type_val|title, type_colors.get(type_val, 'neutral'), size="sm") }}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-900 dark:text-white">
                        {{ auth_val|replace('_', ' ')|title }}
                    </td>
                    <td class="px-6 py-4">
                        <span class="font-mono text-xs text-slate-500 dark:text-slate-400 truncate max-w-xs block">{{ connector.base_url or '-' }}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        {% if connector.is_active %}
                        {{ status_badge("Active", "active", size="sm") }}
                        {% else %}
                        {{ status_badge("Inactive", "neutral", size="sm") }}
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right">
                        {% call row_actions() %}
                            {{ row_action("/admin/integrations/connectors/" ~ connector.id, icon_view(), "View") }}
                        {% endcall %}
                    </td>
                {% endcall %}
                {% endfor %}
            </tbody>
        {% endcall %}
        {% else %}
        {{ empty_state(
            "No connectors",
            "Get started by adding a connector configuration.",
            action_label="Add Connector",
            action_href="/admin/integrations/connectors/new"
        ) }}
        {% endif %}
    {% endcall %}
    </div>

    {% set activity_title = "Integrations Activity" %}
    {% set activity_link = "/admin/system/audit" %}
    {% include "components/data/recent_activity_panel.html" %}
</div>

{{ animation_styles() }}
{% endblock %}
