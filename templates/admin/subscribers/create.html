{% extends "layouts/admin.html" %}

{% block title %}Add Subscriber - Admin{% endblock %}

{% block breadcrumbs %}
<nav class="flex" aria-label="Breadcrumb">
    <ol class="flex items-center space-x-2 text-sm">
        <li><a href="/admin/dashboard" class="text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200">Dashboard</a></li>
        <li><svg class="h-4 w-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg></li>
        <li><a href="/admin/subscribers" class="text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200">Subscribers</a></li>
        <li><svg class="h-4 w-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg></li>
        <li class="text-slate-900 dark:text-white font-medium">Add Subscriber</li>
    </ol>
</nav>
{% endblock %}

{% block page_header %}
<h1 class="text-2xl font-bold text-slate-900 dark:text-white">Add New Subscriber</h1>
{% endblock %}

{% block content %}
<form hx-post="/admin/subscribers"
      hx-target="#form-response"
      x-data="{
          step: 1,
          accountType: 'residential',
          sameAddress: true,
          loading: false
      }"
      x-on:htmx:before-request="loading = true"
      x-on:htmx:after-request="loading = false"
      class="space-y-8">

    <!-- Progress Steps -->
    <div class="rounded-xl border border-slate-200 bg-white p-6 shadow-sm dark:border-slate-700 dark:bg-slate-800">
        <nav aria-label="Progress">
            <ol class="flex items-center">
                <li class="relative pr-8 sm:pr-20 flex-1">
                    <div class="flex items-center">
                        <span :class="step >= 1 ? 'bg-primary-600 text-white' : 'bg-slate-200 text-slate-600 dark:bg-slate-700 dark:text-slate-400'"
                              class="flex h-8 w-8 items-center justify-center rounded-full text-sm font-medium">1</span>
                        <span class="ml-3 text-sm font-medium" :class="step >= 1 ? 'text-primary-600 dark:text-primary-400' : 'text-slate-500 dark:text-slate-400'">Account Info</span>
                    </div>
                    <div class="absolute top-4 left-8 -ml-px h-0.5 w-full sm:w-20" :class="step >= 2 ? 'bg-primary-600' : 'bg-slate-200 dark:bg-slate-700'"></div>
                </li>
                <li class="relative pr-8 sm:pr-20 flex-1">
                    <div class="flex items-center">
                        <span :class="step >= 2 ? 'bg-primary-600 text-white' : 'bg-slate-200 text-slate-600 dark:bg-slate-700 dark:text-slate-400'"
                              class="flex h-8 w-8 items-center justify-center rounded-full text-sm font-medium">2</span>
                        <span class="ml-3 text-sm font-medium" :class="step >= 2 ? 'text-primary-600 dark:text-primary-400' : 'text-slate-500 dark:text-slate-400'">Contact</span>
                    </div>
                    <div class="absolute top-4 left-8 -ml-px h-0.5 w-full sm:w-20" :class="step >= 3 ? 'bg-primary-600' : 'bg-slate-200 dark:bg-slate-700'"></div>
                </li>
                <li class="relative flex-1">
                    <div class="flex items-center">
                        <span :class="step >= 3 ? 'bg-primary-600 text-white' : 'bg-slate-200 text-slate-600 dark:bg-slate-700 dark:text-slate-400'"
                              class="flex h-8 w-8 items-center justify-center rounded-full text-sm font-medium">3</span>
                        <span class="ml-3 text-sm font-medium" :class="step >= 3 ? 'text-primary-600 dark:text-primary-400' : 'text-slate-500 dark:text-slate-400'">Services</span>
                    </div>
                </li>
            </ol>
        </nav>
    </div>

    <!-- Step 1: Account Information -->
    <div x-show="step === 1" x-transition class="rounded-xl border border-slate-200 bg-white shadow-sm dark:border-slate-700 dark:bg-slate-800">
        <div class="border-b border-slate-200 px-6 py-4 dark:border-slate-700">
            <h2 class="text-lg font-semibold text-slate-900 dark:text-white">Account Information</h2>
            <p class="mt-1 text-sm text-slate-500 dark:text-slate-400">Basic subscriber account details</p>
        </div>
        <div class="p-6 space-y-6">
            <!-- Account Type -->
            <div>
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-3">Account Type</label>
                <div class="grid grid-cols-3 gap-4">
                    <label class="relative flex cursor-pointer rounded-lg border p-4 focus:outline-none"
                           :class="accountType === 'residential' ? 'border-primary-500 ring-2 ring-primary-500/20 bg-primary-50 dark:bg-primary-900/20' : 'border-slate-200 dark:border-slate-700'">
                        <input type="radio" name="account_type" value="residential" x-model="accountType" class="sr-only">
                        <div class="flex flex-1 flex-col">
                            <span class="block text-sm font-medium text-slate-900 dark:text-white">Residential</span>
                            <span class="mt-1 text-xs text-slate-500 dark:text-slate-400">Home service</span>
                        </div>
                        <svg x-show="accountType === 'residential'" class="h-5 w-5 text-primary-600" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                    </label>
                    <label class="relative flex cursor-pointer rounded-lg border p-4 focus:outline-none"
                           :class="accountType === 'business' ? 'border-primary-500 ring-2 ring-primary-500/20 bg-primary-50 dark:bg-primary-900/20' : 'border-slate-200 dark:border-slate-700'">
                        <input type="radio" name="account_type" value="business" x-model="accountType" class="sr-only">
                        <div class="flex flex-1 flex-col">
                            <span class="block text-sm font-medium text-slate-900 dark:text-white">Business</span>
                            <span class="mt-1 text-xs text-slate-500 dark:text-slate-400">Small business</span>
                        </div>
                        <svg x-show="accountType === 'business'" class="h-5 w-5 text-primary-600" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                    </label>
                    <label class="relative flex cursor-pointer rounded-lg border p-4 focus:outline-none"
                           :class="accountType === 'enterprise' ? 'border-primary-500 ring-2 ring-primary-500/20 bg-primary-50 dark:bg-primary-900/20' : 'border-slate-200 dark:border-slate-700'">
                        <input type="radio" name="account_type" value="enterprise" x-model="accountType" class="sr-only">
                        <div class="flex flex-1 flex-col">
                            <span class="block text-sm font-medium text-slate-900 dark:text-white">Enterprise</span>
                            <span class="mt-1 text-xs text-slate-500 dark:text-slate-400">Large organization</span>
                        </div>
                        <svg x-show="accountType === 'enterprise'" class="h-5 w-5 text-primary-600" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                    </label>
                </div>
            </div>

            <!-- Organization Name (Business/Enterprise only) -->
            <div x-show="accountType !== 'residential'" x-transition>
                <label for="organization_name" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1.5">Organization Name</label>
                <input type="text" name="organization_name" id="organization_name"
                       class="block w-full rounded-lg border border-slate-300 bg-white px-4 py-2.5 text-sm shadow-sm placeholder-slate-400 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500/20 dark:border-slate-600 dark:bg-slate-700 dark:text-white"
                       placeholder="Company name">
            </div>

            <!-- Name Fields -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label for="first_name" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1.5">First Name <span class="text-red-500">*</span></label>
                    <input type="text" name="first_name" id="first_name" required
                           class="block w-full rounded-lg border border-slate-300 bg-white px-4 py-2.5 text-sm shadow-sm placeholder-slate-400 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500/20 dark:border-slate-600 dark:bg-slate-700 dark:text-white"
                           placeholder="John">
                </div>
                <div>
                    <label for="last_name" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1.5">Last Name <span class="text-red-500">*</span></label>
                    <input type="text" name="last_name" id="last_name" required
                           class="block w-full rounded-lg border border-slate-300 bg-white px-4 py-2.5 text-sm shadow-sm placeholder-slate-400 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500/20 dark:border-slate-600 dark:bg-slate-700 dark:text-white"
                           placeholder="Doe">
                </div>
            </div>

            <!-- Email & Phone -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label for="email" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1.5">Email <span class="text-red-500">*</span></label>
                    <input type="email" name="email" id="email" required
                           class="block w-full rounded-lg border border-slate-300 bg-white px-4 py-2.5 text-sm shadow-sm placeholder-slate-400 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500/20 dark:border-slate-600 dark:bg-slate-700 dark:text-white"
                           placeholder="john@example.com">
                </div>
                <div>
                    <label for="phone" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1.5">Phone</label>
                    <input type="tel" name="phone" id="phone"
                           class="block w-full rounded-lg border border-slate-300 bg-white px-4 py-2.5 text-sm shadow-sm placeholder-slate-400 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500/20 dark:border-slate-600 dark:bg-slate-700 dark:text-white"
                           placeholder="+1 (555) 000-0000">
                </div>
            </div>
        </div>
        <div class="border-t border-slate-200 px-6 py-4 dark:border-slate-700 flex justify-end">
            <button type="button" x-on:click="step = 2"
                    class="rounded-lg bg-primary-600 px-4 py-2 text-sm font-medium text-white hover:bg-primary-700">
                Continue
            </button>
        </div>
    </div>

    <!-- Step 2: Contact & Address -->
    <div x-show="step === 2" x-transition class="rounded-xl border border-slate-200 bg-white shadow-sm dark:border-slate-700 dark:bg-slate-800">
        <div class="border-b border-slate-200 px-6 py-4 dark:border-slate-700">
            <h2 class="text-lg font-semibold text-slate-900 dark:text-white">Service Address</h2>
            <p class="mt-1 text-sm text-slate-500 dark:text-slate-400">Where the service will be installed</p>
        </div>
        <div class="p-6 space-y-6">
            <!-- Street Address -->
            <div>
                <label for="street" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1.5">Street Address <span class="text-red-500">*</span></label>
                <input type="text" name="street" id="street" required
                       class="block w-full rounded-lg border border-slate-300 bg-white px-4 py-2.5 text-sm shadow-sm placeholder-slate-400 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500/20 dark:border-slate-600 dark:bg-slate-700 dark:text-white"
                       placeholder="123 Main St">
            </div>

            <!-- Unit/Apt -->
            <div>
                <label for="unit" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1.5">Apartment, suite, unit, etc.</label>
                <input type="text" name="unit" id="unit"
                       class="block w-full rounded-lg border border-slate-300 bg-white px-4 py-2.5 text-sm shadow-sm placeholder-slate-400 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500/20 dark:border-slate-600 dark:bg-slate-700 dark:text-white"
                       placeholder="Apt 4B">
            </div>

            <!-- City, State, ZIP -->
            <div class="grid grid-cols-6 gap-4">
                <div class="col-span-3">
                    <label for="city" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1.5">City <span class="text-red-500">*</span></label>
                    <input type="text" name="city" id="city" required
                           class="block w-full rounded-lg border border-slate-300 bg-white px-4 py-2.5 text-sm shadow-sm placeholder-slate-400 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500/20 dark:border-slate-600 dark:bg-slate-700 dark:text-white">
                </div>
                <div class="col-span-2">
                    <label for="state" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1.5">State <span class="text-red-500">*</span></label>
                    <select name="state" id="state" required
                            class="block w-full rounded-lg border border-slate-300 bg-white px-4 py-2.5 text-sm shadow-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500/20 dark:border-slate-600 dark:bg-slate-700 dark:text-white">
                        <option value="">Select</option>
                        <option value="CA">California</option>
                        <option value="NY">New York</option>
                        <option value="TX">Texas</option>
                        <!-- Add more states -->
                    </select>
                </div>
                <div class="col-span-1">
                    <label for="zip" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1.5">ZIP <span class="text-red-500">*</span></label>
                    <input type="text" name="zip" id="zip" required
                           class="block w-full rounded-lg border border-slate-300 bg-white px-4 py-2.5 text-sm shadow-sm placeholder-slate-400 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500/20 dark:border-slate-600 dark:bg-slate-700 dark:text-white">
                </div>
            </div>

            <!-- Billing Address Toggle -->
            <div class="flex items-center gap-2">
                <input type="checkbox" name="same_address" id="same_address" x-model="sameAddress"
                       class="h-4 w-4 rounded border-slate-300 text-primary-600 focus:ring-primary-500 dark:border-slate-600 dark:bg-slate-700">
                <label for="same_address" class="text-sm text-slate-700 dark:text-slate-300">Billing address same as service address</label>
            </div>

            <!-- Billing Address (if different) -->
            <div x-show="!sameAddress" x-transition class="space-y-4 rounded-lg border border-slate-200 p-4 dark:border-slate-700">
                <h3 class="text-sm font-medium text-slate-900 dark:text-white">Billing Address</h3>
                <div>
                    <input type="text" name="billing_street" placeholder="Street Address"
                           class="block w-full rounded-lg border border-slate-300 bg-white px-4 py-2.5 text-sm shadow-sm placeholder-slate-400 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500/20 dark:border-slate-600 dark:bg-slate-700 dark:text-white">
                </div>
                <div class="grid grid-cols-6 gap-4">
                    <div class="col-span-3">
                        <input type="text" name="billing_city" placeholder="City"
                               class="block w-full rounded-lg border border-slate-300 bg-white px-4 py-2.5 text-sm shadow-sm placeholder-slate-400 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500/20 dark:border-slate-600 dark:bg-slate-700 dark:text-white">
                    </div>
                    <div class="col-span-2">
                        <select name="billing_state"
                                class="block w-full rounded-lg border border-slate-300 bg-white px-4 py-2.5 text-sm shadow-sm focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500/20 dark:border-slate-600 dark:bg-slate-700 dark:text-white">
                            <option value="">State</option>
                            <option value="CA">CA</option>
                            <option value="NY">NY</option>
                            <option value="TX">TX</option>
                        </select>
                    </div>
                    <div class="col-span-1">
                        <input type="text" name="billing_zip" placeholder="ZIP"
                               class="block w-full rounded-lg border border-slate-300 bg-white px-4 py-2.5 text-sm shadow-sm placeholder-slate-400 focus:border-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-500/20 dark:border-slate-600 dark:bg-slate-700 dark:text-white">
                    </div>
                </div>
            </div>
        </div>
        <div class="border-t border-slate-200 px-6 py-4 dark:border-slate-700 flex justify-between">
            <button type="button" x-on:click="step = 1"
                    class="rounded-lg border border-slate-300 bg-white px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-200 dark:hover:bg-slate-600">
                Back
            </button>
            <button type="button" x-on:click="step = 3"
                    class="rounded-lg bg-primary-600 px-4 py-2 text-sm font-medium text-white hover:bg-primary-700">
                Continue
            </button>
        </div>
    </div>

    <!-- Step 3: Services -->
    <div x-show="step === 3" x-transition class="rounded-xl border border-slate-200 bg-white shadow-sm dark:border-slate-700 dark:bg-slate-800">
        <div class="border-b border-slate-200 px-6 py-4 dark:border-slate-700">
            <h2 class="text-lg font-semibold text-slate-900 dark:text-white">Select Services</h2>
            <p class="mt-1 text-sm text-slate-500 dark:text-slate-400">Choose which services to activate for this subscriber</p>
        </div>
        <div class="p-6">
            <div class="space-y-4">
                {% for offer in available_offers %}
                <label class="relative flex cursor-pointer rounded-lg border p-4 hover:bg-slate-50 dark:hover:bg-slate-700/50"
                       x-data="{ selected: false }"
                       :class="selected ? 'border-primary-500 ring-2 ring-primary-500/20' : 'border-slate-200 dark:border-slate-700'">
                    <input type="checkbox" name="services" value="{{ offer.id }}" x-model="selected" class="sr-only">
                    <div class="flex flex-1 items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="flex h-12 w-12 items-center justify-center rounded-lg bg-primary-100 dark:bg-primary-900/30">
                                <svg class="h-6 w-6 text-primary-600 dark:text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0"/>
                                </svg>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-slate-900 dark:text-white">{{ offer.name }}</p>
                                <p class="text-sm text-slate-500 dark:text-slate-400">{{ offer.description }}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-lg font-semibold text-slate-900 dark:text-white">â‚¦{{ "%.2f" | format(offer.price) }}/mo</p>
                            <p class="text-sm text-slate-500 dark:text-slate-400">{{ offer.speed }}</p>
                        </div>
                    </div>
                    <div class="absolute -inset-px rounded-lg pointer-events-none" :class="selected ? 'border-2 border-primary-500' : ''"></div>
                </label>
                {% else %}
                <p class="text-center text-slate-500 dark:text-slate-400 py-8">No service offers available. <a href="/admin/catalog/offers/create" class="text-primary-600 hover:text-primary-700">Create one</a>.</p>
                {% endfor %}
            </div>
        </div>
        <div class="border-t border-slate-200 px-6 py-4 dark:border-slate-700 flex justify-between">
            <button type="button" x-on:click="step = 2"
                    class="rounded-lg border border-slate-300 bg-white px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 dark:border-slate-600 dark:bg-slate-700 dark:text-slate-200 dark:hover:bg-slate-600">
                Back
            </button>
            <button type="submit"
                    :disabled="loading"
                    class="inline-flex items-center gap-2 rounded-lg bg-primary-600 px-4 py-2 text-sm font-medium text-white hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed">
                <svg x-show="loading" class="h-4 w-4 animate-spin" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span x-text="loading ? 'Creating...' : 'Create Subscriber'">Create Subscriber</span>
            </button>
        </div>
    </div>

    <div id="form-response"></div>
</form>
{% endblock %}
