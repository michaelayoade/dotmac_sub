{% extends "layouts/admin.html" %}

{% block title %}Import IP Pools - Admin{% endblock %}

{% block content %}
<div class="space-y-6">
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-semibold text-slate-900 dark:text-white">Bulk Import IP Pools</h1>
            <p class="mt-1 text-sm text-slate-600 dark:text-slate-400">Import multiple subnets from CSV. Required columns: <span class="font-mono">name,cidr</span>.</p>
        </div>
        <a href="/admin/network/ip-management/pools" class="rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-300">
            Back to pools
        </a>
    </div>

    {% if error %}
    <div class="rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700 dark:border-red-900/40 dark:bg-red-900/10 dark:text-red-300">
        {{ error }}
    </div>
    {% endif %}

    <form method="POST" action="/admin/network/ip-management/pools/import" class="space-y-4 rounded-xl border border-slate-200 bg-white p-4 dark:border-slate-700 dark:bg-slate-800">
        {% include "components/forms/csrf_input.html" %}
        <div>
            <label for="default_ip_version" class="mb-1 block text-sm font-medium text-slate-700 dark:text-slate-300">Default IP version</label>
            <select id="default_ip_version" name="default_ip_version" class="rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-700 dark:border-slate-600 dark:bg-slate-900 dark:text-slate-200">
                <option value="ipv4" {% if default_ip_version == "ipv4" %}selected{% endif %}>IPv4</option>
                <option value="ipv6" {% if default_ip_version == "ipv6" %}selected{% endif %}>IPv6</option>
            </select>
        </div>
        <div>
            <label for="csv_data" class="mb-1 block text-sm font-medium text-slate-700 dark:text-slate-300">CSV data</label>
            <textarea id="csv_data" name="csv_data" rows="12" class="w-full rounded-lg border border-slate-300 px-3 py-2 font-mono text-xs text-slate-700 focus:border-indigo-500 focus:ring-indigo-500 dark:border-slate-600 dark:bg-slate-900 dark:text-slate-200" placeholder="name,cidr,ip_version,gateway,dns_primary,dns_secondary,notes,is_active&#10;Main Pool,10.10.0.0/24,ipv4,10.10.0.1,8.8.8.8,1.1.1.1,Imported,true">{{ csv_data }}</textarea>
        </div>
        <button type="submit" class="rounded-lg bg-slate-900 px-4 py-2 text-sm font-medium text-white hover:bg-slate-700 dark:bg-slate-100 dark:text-slate-900 dark:hover:bg-white">
            Import pools
        </button>
    </form>

    {% if result %}
    <div class="rounded-xl border border-slate-200 bg-white p-4 dark:border-slate-700 dark:bg-slate-800">
        <h2 class="text-sm font-semibold text-slate-900 dark:text-white">Import Result</h2>
        <p class="mt-1 text-sm text-slate-600 dark:text-slate-400">
            Processed {{ result.total_rows }} rows.
            Created {{ result.created|length }} pools.
            Failed {{ result.errors|length }} rows.
        </p>
        {% if result.errors %}
        <div class="mt-4 overflow-x-auto rounded-lg border border-slate-200 dark:border-slate-700">
            <table class="min-w-full divide-y divide-slate-200 dark:divide-slate-700">
                <thead class="bg-slate-50 dark:bg-slate-900/40">
                    <tr>
                        <th class="px-3 py-2 text-left text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400">Line</th>
                        <th class="px-3 py-2 text-left text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400">Name</th>
                        <th class="px-3 py-2 text-left text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400">CIDR</th>
                        <th class="px-3 py-2 text-left text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400">Error</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-200 dark:divide-slate-700">
                    {% for row in result.errors %}
                    <tr>
                        <td class="px-3 py-2 text-xs text-slate-700 dark:text-slate-300">{{ row.line }}</td>
                        <td class="px-3 py-2 text-xs text-slate-700 dark:text-slate-300">{{ row.name }}</td>
                        <td class="px-3 py-2 text-xs font-mono text-slate-700 dark:text-slate-300">{{ row.cidr }}</td>
                        <td class="px-3 py-2 text-xs text-red-700 dark:text-red-300">{{ row.error }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
