<div x-data="customersTable()" class="overflow-visible rounded-2xl border border-slate-200/60 bg-white shadow-sm dark:border-slate-700/60 dark:bg-slate-800">
    <div class="overflow-x-auto overflow-y-visible">
        <table class="min-w-full divide-y divide-slate-200 dark:divide-slate-700">
            <thead class="bg-slate-50/80 dark:bg-slate-800/80">
                <tr>
                    <!-- Select All Checkbox -->
                    <th scope="col" class="w-12 px-4 py-3.5">
                        <input type="checkbox"
                               data-select-all
                               @change="toggleSelectAll($event)"
                               class="h-4 w-4 rounded border-slate-300 text-amber-600 focus:ring-amber-500 dark:border-slate-600 dark:bg-slate-700 dark:ring-offset-slate-800" />
                    </th>
                    <th scope="col" class="px-4 py-3.5 text-left text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400">
                        <button class="group inline-flex items-center gap-1.5 hover:text-slate-700 dark:hover:text-slate-200"
                                hx-get="/admin/customers?sort=name&per_page={{ per_page }}{% if customer_type %}&customer_type={{ customer_type }}{% endif %}{% if search %}&search={{ search }}{% endif %}"
                                hx-target="#customers-table">
                            Customer
                            <svg class="h-3.5 w-3.5 text-slate-400 opacity-0 transition group-hover:opacity-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                            </svg>
                        </button>
                    </th>
                    <th scope="col" class="px-4 py-3.5 text-left text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400">Type</th>
                    <th scope="col" class="hidden px-4 py-3.5 text-left text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400 md:table-cell">Contact</th>
                    <th scope="col" class="px-4 py-3.5 text-left text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400">Status</th>
                    <th scope="col" class="hidden px-4 py-3.5 text-left text-xs font-semibold uppercase tracking-wider text-slate-500 dark:text-slate-400 lg:table-cell">Created</th>
                    <th scope="col" class="sticky right-0 z-10 bg-slate-50/80 px-4 py-3.5 dark:bg-slate-800/80"><span class="sr-only">Actions</span></th>
                </tr>
            </thead>
            <tbody class="divide-y divide-slate-100 bg-white dark:divide-slate-700/50 dark:bg-slate-800">
                {% if customers %}
                {% for customer in customers %}
                <tr class="group transition-colors hover:bg-slate-50/60 dark:hover:bg-slate-700/30"
                    data-customer-id="{{ customer.id }}"
                    data-customer-type="{{ customer.type }}">
                    <!-- Row Checkbox -->
                    <td class="whitespace-nowrap px-4 py-4">
                        <input type="checkbox"
                               data-customer-checkbox
                               data-id="{{ customer.id }}"
                               data-type="{{ customer.type }}"
                               @change="toggleCustomer($event)"
                               class="h-4 w-4 rounded border-slate-300 text-amber-600 focus:ring-amber-500 dark:border-slate-600 dark:bg-slate-700 dark:ring-offset-slate-800" />
                    </td>
                    <td class="whitespace-nowrap px-4 py-4">
                        <a href="/admin/customers/{{ customer.type }}/{{ customer.id }}" class="flex items-center gap-3 group/link">
                            <div class="relative flex-shrink-0">
                                {% if customer.type == 'person' %}
                                <div class="flex h-11 w-11 items-center justify-center rounded-xl bg-gradient-to-br from-blue-100 to-blue-50 text-blue-600 ring-2 ring-white shadow-sm transition group-hover/link:shadow dark:from-blue-900/40 dark:to-blue-900/20 dark:text-blue-400 dark:ring-slate-800">
                                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                                </div>
                                {% else %}
                                <div class="flex h-11 w-11 items-center justify-center rounded-xl bg-gradient-to-br from-purple-100 to-purple-50 text-purple-600 ring-2 ring-white shadow-sm transition group-hover/link:shadow dark:from-purple-900/40 dark:to-purple-900/20 dark:text-purple-400 dark:ring-slate-800">
                                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                                </div>
                                {% endif %}
                                <!-- Status indicator dot -->
                                <span class="absolute -bottom-0.5 -right-0.5 h-3 w-3 rounded-full ring-2 ring-white dark:ring-slate-800 {% if customer.is_active %}bg-indigo-500{% else %}bg-slate-400{% endif %}"></span>
                            </div>
                            <div class="min-w-0">
                                <p class="truncate text-sm font-semibold text-slate-900 transition group-hover/link:text-amber-600 dark:text-white dark:group-hover/link:text-amber-400">
                                    {{ customer.name }}
                                </p>
                                {% if customer.type == 'person' and customer.email %}
                                <p class="truncate text-xs text-slate-500 dark:text-slate-400">{{ customer.email }}</p>
                                {% elif customer.type == 'organization' and customer.raw and customer.raw.domain %}
                                <p class="truncate text-xs text-slate-500 dark:text-slate-400">{{ customer.raw.domain }}</p>
                                {% endif %}
                            </div>
                        </a>
                    </td>
                    <td class="whitespace-nowrap px-4 py-4">
                        {% if customer.type == 'person' %}
                        <span class="inline-flex items-center gap-1.5 rounded-lg bg-blue-50 px-2.5 py-1 text-xs font-medium text-blue-700 dark:bg-blue-900/30 dark:text-blue-300">
                            <svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                            Person
                        </span>
                        {% else %}
                        <span class="inline-flex items-center gap-1.5 rounded-lg bg-purple-50 px-2.5 py-1 text-xs font-medium text-purple-700 dark:bg-purple-900/30 dark:text-purple-300">
                            <svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                            Org
                        </span>
                        {% endif %}
                    </td>
                    <td class="hidden whitespace-nowrap px-4 py-4 md:table-cell">
                        <div class="space-y-1">
                            {% if customer.email %}
                            <a href="mailto:{{ customer.email }}" class="flex items-center gap-1.5 text-xs text-slate-600 hover:text-amber-600 dark:text-slate-400 dark:hover:text-amber-400">
                                <svg class="h-3.5 w-3.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                                <span class="truncate max-w-[140px]">{{ customer.email }}</span>
                            </a>
                            {% endif %}
                            {% if customer.phone %}
                            <a href="tel:{{ customer.phone }}" class="flex items-center gap-1.5 text-xs text-slate-600 hover:text-amber-600 dark:text-slate-400 dark:hover:text-amber-400">
                                <svg class="h-3.5 w-3.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>
                                <span>{{ customer.phone }}</span>
                            </a>
                            {% endif %}
                            {% if not customer.email and not customer.phone %}
                            <span class="text-xs text-slate-400 dark:text-slate-500">No contact info</span>
                            {% endif %}
                        </div>
                    </td>
                    <td class="whitespace-nowrap px-4 py-4">
                        {% if customer.is_active %}
                        <span class="inline-flex items-center gap-1.5 rounded-full bg-green-50 px-2.5 py-1 text-xs font-semibold text-green-700 dark:bg-green-900/30 dark:text-green-400">
                            <span class="h-1.5 w-1.5 animate-pulse rounded-full bg-green-500"></span>
                            Active
                        </span>
                        {% else %}
                        <span class="inline-flex items-center gap-1.5 rounded-full bg-slate-100 px-2.5 py-1 text-xs font-semibold text-slate-600 dark:bg-slate-700 dark:text-slate-400">
                            <span class="h-1.5 w-1.5 rounded-full bg-slate-400"></span>
                            Inactive
                        </span>
                        {% endif %}
                    </td>
                    <td class="hidden whitespace-nowrap px-4 py-4 lg:table-cell">
                        <div class="text-xs">
                            {% set start_date = customer.account_start_date or customer.created_at %}
                            <p class="font-medium text-slate-700 dark:text-slate-300">
                                {{ start_date.strftime('%b %d, %Y') if start_date else 'N/A' }}
                            </p>
                            {% if start_date %}
                            <p class="text-slate-500 dark:text-slate-500">
                                {{ start_date.strftime('%I:%M %p') }}
                            </p>
                            {% endif %}
                        </div>
                    </td>
                    <td class="sticky right-0 z-10 whitespace-nowrap bg-white px-4 py-4 dark:bg-slate-800">
                        <div class="flex items-center justify-end gap-1 opacity-0 transition-opacity group-hover:opacity-100">
                            <a href="/admin/customers/{{ customer.type }}/{{ customer.id }}"
                               class="flex h-8 w-8 items-center justify-center rounded-lg text-slate-400 transition hover:bg-slate-100 hover:text-slate-600 dark:hover:bg-slate-700 dark:hover:text-slate-300"
                               title="View details">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                </svg>
                            </a>
                            <a href="/admin/customers/{{ customer.type }}/{{ customer.id }}/edit"
                               class="flex h-8 w-8 items-center justify-center rounded-lg text-slate-400 transition hover:bg-slate-100 hover:text-amber-600 dark:hover:bg-slate-700 dark:hover:text-amber-400"
                               title="Edit">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                </svg>
                            </a>
                            <!-- Quick actions menu -->
                            <div x-data="{ open: false }" class="relative">
                                <button @click="open = !open"
                                        class="flex h-8 w-8 items-center justify-center rounded-lg text-slate-400 transition hover:bg-slate-100 hover:text-slate-600 dark:hover:bg-slate-700 dark:hover:text-slate-300"
                                        title="More actions">
                                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"/>
                                    </svg>
                                </button>
                                <div x-show="open" @click.away="open = false" x-transition x-cloak
                                     class="absolute right-0 z-20 mt-1 w-44 rounded-xl border border-slate-200 bg-white py-1 shadow-xl dark:border-slate-700 dark:bg-slate-800">
                                    {% if customer.type == 'person' %}
                                    <a href="mailto:{{ customer.email }}" class="flex items-center gap-2 px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 dark:text-slate-300 dark:hover:bg-slate-700">
                                        <svg class="h-4 w-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                                        Send Email
                                    </a>
                                    {% endif %}
                                    <a href="/admin/tickets/new?customer_id={{ customer.id }}&customer_type={{ customer.type }}" class="flex items-center gap-2 px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 dark:text-slate-300 dark:hover:bg-slate-700">
                                        <svg class="h-4 w-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"/></svg>
                                        Create Ticket
                                    </a>
                                    <div class="my-1 border-t border-slate-100 dark:border-slate-700"></div>
                                    {% if customer.is_active %}
                                    <button hx-post="/admin/customers/{{ customer.type }}/{{ customer.id }}/deactivate"
                                            hx-confirm="Deactivate this customer?"
                                            @click="open = false"
                                            class="flex w-full items-center gap-2 px-3 py-2 text-sm text-amber-600 hover:bg-amber-50 dark:text-amber-400 dark:hover:bg-amber-900/20">
                                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"/></svg>
                                        Deactivate
                                    </button>
                                    {% else %}
                                    <button hx-delete="/admin/customers/{{ customer.type }}/{{ customer.id }}"
                                            hx-confirm="Delete this customer? This action cannot be undone."
                                            hx-target="closest tr"
                                            hx-swap="outerHTML swap:0.5s"
                                            @click="open = false"
                                            class="flex w-full items-center gap-2 px-3 py-2 text-sm text-red-600 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20">
                                        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                                        Delete
                                    </button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                {% endfor %}
                {% else %}
                <tr>
                    <td colspan="8" class="px-6 py-16 text-center">
                        <div class="mx-auto max-w-sm">
                            <div class="mx-auto flex h-20 w-20 items-center justify-center rounded-2xl bg-gradient-to-br from-slate-100 to-slate-50 dark:from-slate-700 dark:to-slate-800">
                                <svg class="h-10 w-10 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                                </svg>
                            </div>
                            <h3 class="mt-6 text-base font-semibold text-slate-900 dark:text-white">No customers found</h3>
                            <p class="mt-2 text-sm text-slate-500 dark:text-slate-400">
                                {% if search %}
                                Try adjusting your search or filter criteria.
                                {% else %}
                                Get started by adding your first customer to the system.
                                {% endif %}
                            </p>
                            <div class="mt-8 flex flex-wrap items-center justify-center gap-3">
                                <a href="/admin/customers/new?type=person"
                                   class="inline-flex items-center gap-2 rounded-xl border border-slate-300 bg-white px-4 py-2.5 text-sm font-medium text-slate-700 shadow-sm transition hover:bg-slate-50 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-300 dark:hover:bg-slate-700">
                                    <svg class="h-4 w-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                                    Add Person
                                </a>
                                <a href="/admin/customers/new?type=organization"
                                   class="inline-flex items-center gap-2 rounded-xl bg-gradient-to-r from-amber-500 to-amber-600 px-4 py-2.5 text-sm font-semibold text-white shadow-lg shadow-amber-500/25 transition hover:from-amber-600 hover:to-amber-700">
                                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                                    Add Organization
                                </a>
                            </div>
                        </div>
                    </td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    {% if total_pages > 1 %}
    <div class="border-t border-slate-200/60 bg-slate-50/60 px-4 py-3 dark:border-slate-700/60 dark:bg-slate-800/60">
        <div class="flex flex-col items-center justify-between gap-3 sm:flex-row">
            <p class="text-sm text-slate-500 dark:text-slate-400">
                Showing <span class="font-semibold text-slate-700 dark:text-slate-300">{{ (page - 1) * per_page + 1 }}</span> to
                <span class="font-semibold text-slate-700 dark:text-slate-300">{{ [page * per_page, total] | min }}</span> of
                <span class="font-semibold text-slate-700 dark:text-slate-300">{{ total }}</span> customers
            </p>
            <nav class="flex items-center gap-1">
                <!-- Previous -->
                {% if page > 1 %}
                <button hx-get="/admin/customers?page={{ page - 1 }}&per_page={{ per_page }}{% if customer_type %}&customer_type={{ customer_type }}{% endif %}{% if search %}&search={{ search }}{% endif %}"
                        hx-target="#customers-table"
                        class="flex h-9 w-9 items-center justify-center rounded-lg text-slate-500 transition hover:bg-white hover:text-slate-700 hover:shadow-sm dark:hover:bg-slate-700 dark:hover:text-slate-300">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
                </button>
                {% else %}
                <span class="flex h-9 w-9 items-center justify-center text-slate-300 dark:text-slate-600">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
                </span>
                {% endif %}

                <!-- Page Numbers -->
                <div class="flex items-center gap-0.5">
                    {% for p in range(1, total_pages + 1) %}
                        {% if p == page %}
                        <span class="flex h-9 min-w-[36px] items-center justify-center rounded-lg bg-amber-500 px-3 text-sm font-semibold text-white shadow-sm">{{ p }}</span>
                        {% elif p == 1 or p == total_pages or (p >= page - 1 and p <= page + 1) %}
                        <button hx-get="/admin/customers?page={{ p }}&per_page={{ per_page }}{% if customer_type %}&customer_type={{ customer_type }}{% endif %}{% if search %}&search={{ search }}{% endif %}"
                                hx-target="#customers-table"
                                class="flex h-9 min-w-[36px] items-center justify-center rounded-lg px-3 text-sm font-medium text-slate-600 transition hover:bg-white hover:shadow-sm dark:text-slate-400 dark:hover:bg-slate-700">
                            {{ p }}
                        </button>
                        {% elif p == page - 2 or p == page + 2 %}
                        <span class="flex h-9 w-9 items-center justify-center text-slate-400 dark:text-slate-500">...</span>
                        {% endif %}
                    {% endfor %}
                </div>

                <!-- Next -->
                {% if page < total_pages %}
                <button hx-get="/admin/customers?page={{ page + 1 }}&per_page={{ per_page }}{% if customer_type %}&customer_type={{ customer_type }}{% endif %}{% if search %}&search={{ search }}{% endif %}"
                        hx-target="#customers-table"
                        class="flex h-9 w-9 items-center justify-center rounded-lg text-slate-500 transition hover:bg-white hover:text-slate-700 hover:shadow-sm dark:hover:bg-slate-700 dark:hover:text-slate-300">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                </button>
                {% else %}
                <span class="flex h-9 w-9 items-center justify-center text-slate-300 dark:text-slate-600">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                </span>
                {% endif %}
            </nav>
        </div>
    </div>
    {% elif total > 0 %}
    <div class="border-t border-slate-200/60 bg-slate-50/60 px-4 py-3 dark:border-slate-700/60 dark:bg-slate-800/60">
        <p class="text-center text-sm text-slate-500 dark:text-slate-400">
            Showing all <span class="font-semibold text-slate-700 dark:text-slate-300">{{ total }}</span> customers
        </p>
    </div>
    {% endif %}
</div>

<script>
function customersTable() {
    return {
        toggleSelectAll(event) {
            const checked = event.target.checked;
            const checkboxes = document.querySelectorAll('[data-customer-checkbox]');
            const customers = [];

            checkboxes.forEach(cb => {
                cb.checked = checked;
                if (checked) {
                    customers.push({
                        id: cb.dataset.id,
                        type: cb.dataset.type
                    });
                }
            });

            document.dispatchEvent(new CustomEvent('customers-select-all', {
                detail: { customers, checked }
            }));
        },

        toggleCustomer(event) {
            const checkbox = event.target;
            document.dispatchEvent(new CustomEvent('customer-selected', {
                detail: {
                    id: checkbox.dataset.id,
                    type: checkbox.dataset.type,
                    checked: checkbox.checked
                }
            }));

            // Update select-all state
            const checkboxes = document.querySelectorAll('[data-customer-checkbox]');
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            const selectAll = document.querySelector('[data-select-all]');
            if (selectAll) {
                selectAll.checked = allChecked;
                selectAll.indeterminate = !allChecked && Array.from(checkboxes).some(cb => cb.checked);
            }
        }
    };
}
</script>
