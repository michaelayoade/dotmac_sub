{#
  Reusable file upload drop zone component.

  Usage:
    {% from "components/_file_upload.html" import file_upload_zone %}

    {{ file_upload_zone(
        name="logo_file",
        label="Upload Logo",
        hint="Recommended size: 200x50px. Max 5MB.",
        accept="image/*",
        max_size_mb=5,
        preview="image",
        current_url=branding.logo_url,
        remove_name="remove_logo"
    ) }}

  Parameters:
    name        — form field name (required)
    label       — heading text above the drop zone
    hint        — help text below the drop zone
    accept      — HTML accept attribute for <input type="file">
    max_size_mb — client-side max file size in MB (default 10)
    preview     — "image" / "icon" / "none" (default "none")
    current_url — URL of existing file to show as preview
    remove_name — if set, shows a "remove current file" checkbox with this name
#}

{% macro file_upload_zone(
    name,
    label="Upload File",
    hint="",
    accept="",
    max_size_mb=10,
    preview="none",
    current_url="",
    remove_name=""
) %}
<div x-data='fileUpload({ maxSizeMB: {{ max_size_mb }}, accept: "{{ accept }}", preview: "{{ preview }}", inputName: "{{ name }}", label: "{{ label }}" })'>
    {# Label #}
    {% if label %}
    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1.5">{{ label }}</label>
    {% endif %}

    {# Existing file preview #}
    {% if current_url %}
    <div class="mb-3 flex items-center gap-3 rounded-lg bg-slate-50 p-3 dark:bg-slate-800/60" x-show="!hasFile">
        {% if preview == "image" or preview == "icon" %}
        <img src="{{ current_url }}" alt="Current file"
             class="{{ 'h-6 w-6 rounded' if preview == 'icon' else 'max-h-14 object-contain rounded' }}">
        {% endif %}
        <span class="text-xs text-slate-500 dark:text-slate-400">Current file</span>
    </div>
    {% endif %}

    {# Drop zone (shown when no file selected) #}
    <div x-show="!hasFile"
         x-on:dragover="onDragOver($event)"
         x-on:dragleave="onDragLeave($event)"
         x-on:drop="onDrop($event)"
         x-on:click="$refs.fileInput.click()"
         :class="isDragging ? 'border-accent-400 bg-accent-50 dark:bg-accent-900/20' : 'border-slate-300 dark:border-slate-600 hover:border-accent-400 dark:hover:border-accent-500'"
         class="flex cursor-pointer flex-col items-center justify-center rounded-lg border-2 border-dashed px-6 py-8 transition-colors">
        {# Upload icon #}
        <svg class="mb-2 h-8 w-8 text-slate-400 dark:text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                  d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
        </svg>
        <span class="text-sm font-medium text-slate-600 dark:text-slate-300">
            Drop file here or <span class="text-accent-600 dark:text-accent-400 underline">click to browse</span>
        </span>
        {% if hint %}
        <span class="mt-1 text-xs text-slate-400 dark:text-slate-500">{{ hint }}</span>
        {% endif %}
    </div>

    {# Selected file card (shown when file is selected) #}
    <div x-show="hasFile" x-cloak
         class="flex items-center gap-3 rounded-lg border border-slate-200 bg-white p-3 dark:border-slate-700 dark:bg-slate-800">
        {# Preview thumbnail #}
        <template x-if="previewUrl">
            <img :src="previewUrl" alt="Preview"
                 class="{{ 'h-8 w-8 rounded object-cover' if preview == 'icon' else 'h-12 w-12 rounded object-cover' }}">
        </template>
        <template x-if="!previewUrl">
            <div class="flex h-10 w-10 items-center justify-center rounded bg-slate-100 dark:bg-slate-700">
                <svg class="h-5 w-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
            </div>
        </template>

        {# File info #}
        <div class="min-w-0 flex-1">
            <p class="truncate text-sm font-medium text-slate-700 dark:text-slate-200" x-text="fileName"></p>
            <p class="text-xs text-slate-400 dark:text-slate-500" x-text="fileSizeDisplay"></p>
        </div>

        {# Clear button #}
        <button type="button" x-on:click="clearFile()"
                class="rounded-md p-1.5 text-slate-400 hover:bg-slate-100 hover:text-slate-600 dark:hover:bg-slate-700 dark:hover:text-slate-300 transition-colors"
                title="Remove file" aria-label="Remove file">
            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
        </button>
    </div>

    {# Error message #}
    <p x-show="errorMessage" x-text="errorMessage" x-cloak
       class="mt-1.5 text-xs text-red-600 dark:text-red-400"></p>

    {# Hidden file input #}
    <input type="file"
           x-ref="fileInput"
           x-on:change="onInputChange($event)"
           name="{{ name }}"
           {% if accept %}accept="{{ accept }}"{% endif %}
           class="sr-only"
           tabindex="-1">

    {# Remove checkbox (for edit forms with existing files) #}
    {% if remove_name %}
    <label class="mt-2 flex items-center gap-2 text-xs text-slate-600 dark:text-slate-400" x-show="!hasFile">
        <input type="checkbox" name="{{ remove_name }}" value="true"
               class="rounded border-slate-300 dark:border-slate-600 text-accent-600">
        Remove current file
    </label>
    {% endif %}
</div>
{% endmacro %}
